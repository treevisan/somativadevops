name: CI

on:
  pull_request:
    branches:
      - main

  workflow_dispatch:

jobs:
  build-job:
    runs-on: ubuntu-latest
    
    steps:
      - uses: actions/checkout@v3
      - run: python3 -V
      - name: Build
        run: echo "Build ok"

  test-job:
    runs-on: ubuntu-latest
    steps:
        - uses: actions/checkout@v3
        - name: Install dependencies
          run: pip install Flask
        -  run: python3 app.py
        #- name: Run SAST scan 
        - uses: AppThreat/sast-scan-action@v1.0.0
          with:
            type: "python"
            #scan-type: 'snyk'
            #snyk-token: ${{ secrets.TOKEN_IN }}

  deploy-job:
      runs-on: ubuntu-latest
      needs: test-job
      
      steps:
        - name: Checkout code
          uses: actions/checkout@v2

        - name: Log in to Docker Hub
          uses: docker/login-action@v1
          with:
           username: ${{ secrets.USERNAME_DOCKER }}
           password: ${{ secrets.PASSWORD_DOCKER }}
           
        -  name: Build Docker image
           run: docker build -t ggtte/reposo:latest .

        - name: Push Docker image
          run: docker push ggtte/reposo:latest
       # - name: Build and push Docker image
       #   uses: docker/build-push-action@v2
       #   with:
          #   context: .
            # push: true
           #  tags: ggtte/reposo:tag

        # - name: Deploy
         #  run: echo "Deploy ok"


          
          
